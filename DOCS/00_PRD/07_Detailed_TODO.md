## 7) Детальный TODO (этапы, атомарные задачи с метаданными)

| ID   | Задача                                 | Вход              | Процесс                                 | Выход              | Приор. | Оценка | Зависимости | Критерии приёмки                                                   |
| ---- | -------------------------------------- | ----------------- | --------------------------------------- | ------------------ | ------ | ------ | ----------- | ------------------------------------------------------------------ |
| R1   | Настроить AudioSession (PlayAndRecord) | нет               | Конфиг, уведомления прерываний/маршрута | активная сессия    | High   | 4h     | —           | Запись/воспроизведение не прерываются, корректная пауза при звонке |
| R2   | Пайплайн записи на AVAudioEngine       | RecordingSettings | inputNode→converter→AVAudioFile         | .m4a файл          | High   | 2d     | R1          | Файл воспроизводим, длительность точна (±50мс/час)                 |
| R3   | Пауза/возобновление записи             | state             | останов буфера без закрытия файла       | обновлённый файл   | High   | 6h     | R2          | Нет щелчков, таймер считает общее время                            |
| R4   | Метры L/R (RMS/Peak, 20–30 Гц)         | аудио буферы      | tap+DSP                                 | значения для UI    | High   | 1d     | R2          | В реальном времени, без лагов, CPU < 10%                           |
| R5   | Источник записи (route picker)         | маршруты          | выбор через AVAudioSession              | активный источник  | Med    | 6h     | R1          | Смена без краша, индикация                                         |
| R6   | Метаданные текущей записи              | имя/путь          | обновление JSON                         | файл meta          | Med    | 4h     | R2          | Имя, размер, формат, время обновляются                             |
| P1   | Пайплайн проигрывания                  | файл              | playerNode+timePitch+mixer              | звук               | High   | 2d     | R1          | Играет все поддерж. файлы, позиция точна                           |
| P2   | Прогресс/позиция                       | таймер            | опрос playerTime                        | UI обновление      | High   | 6h     | P1          | Дрифтов нет (>0.5с/час)                                            |
| P3   | Перемотки tap ±10с                     | жест              | nudge                                   | новая позиция      | High   | 4h     | P1          | Шаги точные, не клипают звук                                       |
| P4   | Перемотки удержанием                   | жест              | повтор nudge/200мс + «со звуком»        | быстрая навигация  | Med    | 8h     | P1,P3       | Чёткая обратная связь, лаг <100мс                                  |
| P5   | DPC Rate/Pitch                         | значения          | конфиг AVAudioUnitTimePitch             | изменённый звук    | High   | 1d     | P1          | Без артефактов, смена on‑the‑fly                                   |
| P6   | Громкость Master и L/R                 | значения          | mixer gains/panner                      | изменённый уровень | Med    | 1d     | P1          | Линейная реакция, без клиппинга                                    |
| P7   | A‑B Loop                               | A/B               | цикл в рендере/таймере                  | зацикливание       | Med    | 1d     | P1,P2       | Никаких щелчков на переходе                                        |
| UI1  | Экран по макету                        | дизайн            | SwiftUI компоненты                      | пиксель‑перф       | High   | 3d     | P2,R4       | Соответствие отступов, цветов, размеров                            |
| UI2  | Waveform Live                          | RMS/Peak          | Canvas/Metal                            | график             | High   | 2d     | R4          | Частота ≥30 FPS, гладко                                            |
| UI3  | Waveform Offline                       | файл              | предрасчёт + кеш                        | превью             | Med    | 2d     | P1,FS1      | Быстрый скролл списка, кеш <5% диска                               |
| FM1  | Структура каталогов                    | нет               | /Documents/Recordings                   | каталог            | High   | 2h     | —           | Права, бэкап‑политика ok                                           |
| FM2  | Список файлов                          | диск              | FileManager+AVAsset                     | [FileMeta]         | High   | 1d     | FM1         | Все атрибуты заполнены                                             |
| FM3  | Копирование/Удаление/Переименование    | id                | операции на фоне                        | новый id           | Med    | 1d     | FM2         | UI не блокируется                                                  |
| FM4  | Свободное место                        | —                 | URLResourceValues                       | bytes              | Low    | 2h     | FM1         | Значение корректно                                                 |
| BM1  | Закладки T‑MARK                        | pos               | append → meta.json                      | bookmarks[]        | Med    | 1d     | P2,FM2      | Видны и выбираемы в UI                                             |
| ST1  | Настройки записи                       | UI                | UserDefaults+JSON                       | RecordingSettings  | Med    | 1d     | R2          | Применяются к новой записи                                         |
| SEC1 | Блокировка UI                          | жест              | оверлей + haptics                       | анти‑misclick      | Med    | 6h     | UI1         | Разблокировка удержанием 2с                                        |
| QA1  | Юнит‑тесты AudioCore                   | —                 | XCTest                                  | отчёт              | High   | 1d     | ядро        | Покрытие ключевых путей                                            |
| QA2  | UI‑тесты базовые                       | —                 | XCUITest                                | отчёт              | Med    | 1d     | UI1         | Регресс минимум                                                    |